# スタッフ管理機能

店舗スタッフのログイン機能を拡張し、以下の機能を実装しました。

## 実装した機能

### 1. スタッフの新規追加
- **権限**: オーナー・管理者のみ
- **機能**: 新しいスタッフを追加
- **入力項目**:
  - ユーザー名（必須）
  - パスワード（必須、6文字以上）
  - 表示名（必須）
  - メールアドレス（任意）
  - 役割（オーナーのみ設定可能、デフォルト: スタッフ）

### 2. ログアウト
- **権限**: 全スタッフ
- **機能**: セッションを終了し、トップページにリダイレクト

### 3. パスワード変更
- **権限**: 全スタッフ（自分のパスワードのみ）
- **管理者**: 他のスタッフのパスワードも変更可能
- **機能**: 
  - 自分のパスワード変更: 現在のパスワードが必要
  - 管理者による変更: 現在のパスワード不要

### 4. メールアドレス変更
- **権限**: 全スタッフ（自分の情報のみ）
- **管理者**: 他のスタッフの情報も変更可能
- **機能**: メールアドレスの更新

## データベース変更

### usersテーブルにemailカラムを追加

```sql
ALTER TABLE `users` ADD COLUMN `email` VARCHAR(255) COMMENT 'メールアドレス' AFTER `name`;
```

または、`database/migration-add-email.sql`を実行してください。

## APIエンドポイント

### GET /api/users
- **説明**: 店舗内のスタッフ一覧を取得
- **権限**: オーナー・管理者のみ
- **レスポンス**: ユーザー配列

### POST /api/users
- **説明**: 新しいスタッフを追加
- **権限**: オーナー・管理者のみ
- **リクエストボディ**:
  ```json
  {
    "username": "staff001",
    "password": "password123",
    "name": "スタッフ1",
    "email": "staff1@example.com",
    "role": "staff"
  }
  ```

### GET /api/users/{id}
- **説明**: 特定のスタッフ情報を取得
- **権限**: 自分の情報、または管理者権限

### PUT /api/users/{id}
- **説明**: スタッフ情報を更新
- **権限**: 自分の情報、または管理者権限
- **リクエストボディ**:
  ```json
  {
    "name": "更新後の名前",
    "email": "newemail@example.com",
    "role": "manager",
    "isActive": true
  }
  ```

### PUT /api/users/{id}/password
- **説明**: パスワードを変更
- **権限**: 自分のパスワード、または管理者権限
- **リクエストボディ**:
  ```json
  {
    "currentPassword": "oldpassword",
    "newPassword": "newpassword123"
  }
  ```

### DELETE /api/users/{id}
- **説明**: スタッフを削除
- **権限**: オーナーのみ（自分自身は削除不可）

## フロントエンドページ

### /admin/users
- **説明**: スタッフ管理一覧ページ
- **機能**:
  - スタッフ一覧表示
  - スタッフ追加（モーダル）
  - スタッフ編集へのリンク
  - パスワード変更へのリンク
  - スタッフ削除（オーナーのみ）

### /admin/users/{id}/edit
- **説明**: スタッフ情報編集ページ
- **機能**:
  - 表示名の変更
  - メールアドレスの変更
  - 役割の変更（オーナーのみ）
  - 有効/無効の切り替え（管理者のみ）

### /admin/users/{id}/password
- **説明**: パスワード変更ページ
- **機能**:
  - 自分のパスワード変更: 現在のパスワード + 新しいパスワード
  - 管理者による変更: 新しいパスワードのみ

### /admin/users/password
- **説明**: 自分のパスワード変更ページ（ショートカット）

## 権限レベル

1. **staff（スタッフ）**
   - 自分の情報の閲覧・編集
   - 自分のパスワード変更

2. **manager（管理者）**
   - スタッフの追加
   - スタッフ情報の編集
   - スタッフの有効/無効切り替え
   - スタッフのパスワード変更

3. **owner（オーナー）**
   - すべての管理者権限
   - スタッフの役割変更
   - スタッフの削除

## セットアップ手順

1. **データベースマイグレーション**
   ```sql
   -- usersテーブルにemailカラムを追加
   ALTER TABLE `users` ADD COLUMN `email` VARCHAR(255) COMMENT 'メールアドレス' AFTER `name`;
   ```

2. **APIファイルの配置**
   - `api-server/api/users.php` を配置
   - `api-server/api/index.php` にusersルーティングを追加済み

3. **フロントエンドファイルの配置**
   - `stores/user.ts` - ユーザー管理ストア
   - `pages/admin/users/index.vue` - スタッフ管理一覧
   - `pages/admin/users/[id]/edit.vue` - スタッフ編集
   - `pages/admin/users/[id]/password.vue` - パスワード変更
   - `pages/admin/users/password.vue` - 自分のパスワード変更

4. **型定義の更新**
   - `types/multi-shop.ts` のUser型にemailフィールドを追加済み

## 使用方法

1. **スタッフの追加**
   - `/admin/users` にアクセス
   - 「スタッフを追加」ボタンをクリック
   - 必要情報を入力して追加

2. **スタッフ情報の編集**
   - `/admin/users` でスタッフの「編集」ボタンをクリック
   - または `/admin/users/{id}/edit` に直接アクセス

3. **パスワード変更**
   - `/admin/users` でスタッフの「パスワード変更」ボタンをクリック
   - または `/admin/users/{id}/password` に直接アクセス
   - 自分のパスワード変更は `/admin/users/password` からも可能

4. **ログアウト**
   - 各管理ページの「ログアウト」ボタンをクリック

## 注意事項

- パスワードは6文字以上で設定してください
- オーナーは自分自身を削除できません
- 管理者は他のスタッフの役割を変更できません（オーナーのみ可能）
- メールアドレスは任意項目です

